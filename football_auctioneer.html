<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>We Are Eleven – Auctioneer</title>
  <meta name="color-scheme" content="dark light" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: "Outfit", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      margin: 0;
      color: #0f172a; /* slate-900 */
      background: #f8fafc; /* slate-50 */
    }

    :root {
      --bg: #0b1220;      /* deep slate for header/footer */
      --card: #0f172a;    /* slate-900 */
      --muted: #94a3b8;   /* slate-400 */
      --ring: #cbd5e1;    /* slate-300 */
      --accent: #334155;  /* slate-700 */
      --accent-2: #1e293b;/* slate-800 */
      --brand: #fbbf24;   /* amber-400 */
      --brand-2: #f59e0b; /* amber-500 */
      --success: #22c55e; /* green-500 */
      --danger: #ef4444;  /* red-500 */
      --rose-600: #e11d48;
      --rose-700: #be123c;
    }

    a, button {
      font-family: inherit;
    }

    .container {
      max-width: 1200px;
      margin-inline: auto;
      padding-inline: 16px;
    }

    header.sticky {
      position: sticky;
      top: 0;
      z-index: 50;
      background: var(--bg);
      color: white;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      backdrop-filter: saturate(130%) blur(6px);
    }

    .header-inner {
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 12px;
      padding: 12px 0;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      color: white;
    }
    .brand .logo {
      width: 36px;
      height: 36px;
      display: grid;
      place-items: center;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--brand), var(--brand-2));
      color: #111827;
      font-weight: 800;
    }
    .brand .title {
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    .brand .subtitle {
      font-size: 12px;
      color: #e5e7eb;
      opacity: 0.9;
    }

    .toolbar {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .btn {
      padding: 8px 12px;
      border-radius: 12px;
      border: 1px solid transparent;
      background: var(--accent-2);
      color: #fff;
      cursor: pointer;
      transition: 120ms ease;
      font-weight: 600;
      user-select: none;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .btn:hover { filter: brightness(1.05); transform: translateY(-0.5px); }
    .btn:active { transform: translateY(0); }
    .btn-outline {
      background: transparent;
      border-color: rgba(255,255,255,0.18);
      color: #fff;
    }
    .btn-ghost {
      background: transparent;
      color: #e5e7eb;
    }
    .btn-success { background: #166534; }
    .btn-danger { background: #7f1d1d; }

    .btn-logout {
      background: var(--rose-600);
    }
    .btn-logout:hover { background: var(--rose-700); }

    main {
      padding: 20px 0 64px;
    }

    .layout {
      display: grid;
      grid-template-columns: 280px 1fr 320px;
      gap: 16px;
    }
    @media (max-width: 1100px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    /* Cards */
    .card {
      background: white;
      border: 1px solid #e2e8f0; /* slate-200 */
      border-radius: 16px;
      box-shadow: 0 1px 2px rgba(15, 23, 42, 0.04);
    }
    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      border-bottom: 1px solid #e2e8f0;
      background: #f8fafc;
      border-radius: 16px 16px 0 0;
    }
    .card-title { font-weight: 700; }
    .card-body { padding: 14px 16px; }

    /* Left – Filters & Pools */
    .filters { display: grid; gap: 12px; }
    .field {
      display: grid;
      gap: 6px;
    }
    .field label {
      font-size: 12px; color: var(--accent);
    }
    .select, .input {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #cbd5e1;
      background: #fff;
      font: inherit;
    }

    .pools {
      display: grid;
      gap: 12px;
    }
    .pool-chips {
      display: flex; flex-wrap: wrap; gap: 6px;
    }
    .chip {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #cbd5e1;
      background: #fff;
      font-size: 12px;
      display: inline-flex; align-items: center; gap: 6px;
    }
    .chip b { font-weight: 700; font-variant-numeric: tabular-nums; }

    /* Middle – Draft table & actions */
    .actions {
      display: flex; flex-wrap: wrap; align-items: center; gap: 10px;
    }
    .search {
      display: flex; gap: 8px; align-items: center;
      background: white; border: 1px solid #cbd5e1; border-radius: 12px; padding: 8px 10px;
    }
    .search input {
      border: 0; outline: 0; font: inherit; width: 220px;
    }
    .tabs {
      display: flex; flex-wrap: wrap; gap: 6px;
    }
    .tab {
      padding: 8px 12px; border-radius: 12px; border: 1px solid #cbd5e1; background: white; cursor: pointer;
      font-weight: 600; font-size: 14px;
    }
    .tab[aria-selected="true"] { background: #111827; color: white; border-color: #111827; }

    table {
      width: 100%;
      border-collapse: collapse;
      font-variant-numeric: tabular-nums;
    }
    th, td {
      padding: 10px 12px;
      border-bottom: 1px solid #e2e8f0;
      text-align: left;
    }
    thead th {
      position: sticky;
      top: 0;
      z-index: 1;
      background: #0f172a;
      color: white;
    }
    tbody tr:hover { background: #f8fafc; }
    .row-actions {
      display: flex; gap: 6px; align-items: center; justify-content: flex-end;
    }

    /* Right – Stats / Results */
    .grid {
      display: grid; gap: 12px;
    }

    .results-toolbar {
      display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap;
    }

    .badge {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 6px 10px; border-radius: 999px; font-weight: 600; font-size: 12px;
      background: #111827; color: #fff;
      border: 1px solid #0b1220;
    }
    .badge .dot {
      width: 8px; height: 8px; border-radius: 999px; background: #22c55e;
    }

    .hidden { display: none !important; }

    .muted { color: var(--muted); }

    .monospace { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    footer {
      margin-top: 40px;
      padding: 24px 0 48px;
      color: #cbd5e1;
      background: var(--bg);
      border-top: 1px solid rgba(255,255,255,0.08);
    }

    .kbd {
      display: inline-flex; align-items: center; justify-content: center;
      border: 1px solid #cbd5e1; background: #fff; border-bottom-width: 2px; border-radius: 8px;
      padding: 0 6px; height: 22px; font-size: 12px; min-width: 22px; font-weight: 700;
    }

    .hint {
      padding: 10px 12px; border: 1px dashed #cbd5e1; background: #fff; border-radius: 12px; font-size: 13px;
    }

    /* Utility */
    .sr-only {
      position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden;
      clip: rect(0,0,0,0); white-space: nowrap; border: 0;
    }
  </style>
</head>
<body>
  <header class="sticky">
    <div class="container header-inner">
      <a class="brand" href="index.html">
        <div class="logo">11</div>
        <div>
          <div class="title">We Are Eleven</div>
          <div class="subtitle">Auctioneer Console</div>
        </div>
      </a>

      <div class="toolbar" role="toolbar" aria-label="Auctioneer actions">
        <button id="btnSave" class="btn btn-success" title="Save draft (Ctrl/⌘+S)">Save</button>
        <button id="btnLoad" class="btn btn-outline" title="Load previous draft">Load</button>
        <button id="btnExportCsv" class="btn" title="Export auction data as CSV">Export CSV</button>
        <button id="btnReset" class="btn btn-danger" title="Reset all data">Reset</button>
        <!-- Replaced 'Auction Unsold Players' button with Logout link -->
        <a href="index.html" id="btnLogout" class="btn btn-logout" title="Logout to home">Logout</a>
      </div>
    </div>
  </header>

  <main>
    <div class="container layout">
      <!-- LEFT: Filters & Pools -->
      <aside class="card">
        <div class="card-header">
          <div class="card-title">Filters</div>
          <button id="btnClearFilters" class="btn btn-ghost">Clear</button>
        </div>
        <div class="card-body">
          <div class="filters">
            <div class="field">
              <label for="search">Search Player</label>
              <input id="search" class="input" placeholder="Type name…" />
            </div>
            <div class="field">
              <label for="filterRole">Role</label>
              <select id="filterRole" class="select">
                <option value="">All</option>
                <option>GK</option>
                <option>DEF</option>
                <option>MID</option>
                <option>FWD</option>
              </select>
            </div>
            <div class="field">
              <label for="filterCategory">Category</label>
              <select id="filterCategory" class="select">
                <option value="">All</option>
                <option>Gold</option>
                <option>Silver</option>
                <option>UnSold</option>
              </select>
            </div>
            <div class="field">
              <label for="filterTeam">Team</label>
              <select id="filterTeam" class="select">
                <option value="">All</option>
                <option>Blazers</option>
                <option>Dominators</option>
                <option>Rockets</option>
                <option>Spartans</option>
                <option>Titans</option>
                <option>Warriors</option>
              </select>
            </div>
          </div>

          <hr style="margin:16px 0;border:none;border-top:1px solid #e2e8f0" />

          <div class="pools">
            <div class="card-title">Pools</div>
            <div class="pool-chips">
              <span class="chip"><span>Gold</span><b id="countGold">0</b></span>
              <span class="chip"><span>Silver</span><b id="countSilver">0</b></span>
              <span class="chip"><span>UnSold</span><b id="countUnSold">0</b></span>
            </div>
          </div>

          <hr style="margin:16px 0;border:none;border-top:1px solid #e2e8f0" />

          <div class="hint">
            <b>Tip:</b> Use <span class="kbd">Ctrl</span> + <span class="kbd">K</span> to focus search. Press <span class="kbd">?</span> to toggle help.
          </div>
        </div>
      </aside>

      <!-- MIDDLE: Players table -->
      <section class="card">
        <div class="card-header">
          <div class="actions">
            <div class="search">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" /></svg>
              <input id="search2" placeholder="Search name, role, team…" />
            </div>

            <div class="tabs" role="tablist" aria-label="Player category">
              <button class="tab" data-tab="ALL" aria-selected="true">All</button>
              <button class="tab" data-tab="Gold">Gold</button>
              <button class="tab" data-tab="Silver">Silver</button>
              <button class="tab" data-tab="UnSold">UnSold</button>
            </div>
          </div>
        </div>

        <div class="card-body" style="padding:0">
          <div style="overflow:auto;border-radius:0 0 16px 16px">
            <table id="playersTable">
              <thead>
                <tr>
                  <th style="width:36px">#</th>
                  <th>Player</th>
                  <th>Role</th>
                  <th>Team</th>
                  <th style="width:120px">Pool</th>
                  <th style="width:220px">Actions</th>
                </tr>
              </thead>
              <tbody id="tbodyPlayers"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- RIGHT: Results -->
      <aside class="grid">
        <section class="card">
          <div class="card-header">
            <div class="card-title">Results</div>
            <div class="results-toolbar">
              <span class="badge"><span class="dot"></span>Live</span>
              <button id="btnToggleResults" class="btn btn-ghost" aria-pressed="false" title="Hide/Show results panel">Toggle</button>
            </div>
          </div>
          <div class="card-body" id="resultsBody">
            <div style="display:grid;gap:8px">
              <div class="field">
                <label for="resultTeam">Team</label>
                <select id="resultTeam" class="select">
                  <option>Blazers</option>
                  <option>Dominators</option>
                  <option>Rockets</option>
                  <option>Spartans</option>
                  <option>Titans</option>
                  <option>Warriors</option>
                </select>
              </div>

              <div class="field">
                <label for="resultPlayer">Player</label>
                <input id="resultPlayer" class="input" placeholder="Player name" />
              </div>

              <div class="field">
                <label for="resultAmount">Amount</label>
                <input id="resultAmount" class="input" type="number" min="0" placeholder="Bid amount" />
              </div>

              <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
                <button id="btnAddResult" class="btn btn-success">Add Result</button>
                <button id="btnClearResult" class="btn btn-outline">Clear</button>
              </div>

              <hr style="margin:12px 0;border:none;border-top:1px solid #e2e8f0" />

              <div style="display:grid;gap:8px">
                <div class="card-title">Recent</div>
                <div id="recentList" style="display:grid;gap:8px"></div>
              </div>
            </div>
          </div>
        </section>

        <section class="card">
          <div class="card-header">
            <div class="card-title">Shortcuts</div>
          </div>
          <div class="card-body" style="display:grid;gap:8px">
            <div class="hint">
              <b>Search</b> – <span class="kbd">Ctrl</span> + <span class="kbd">K</span>
            </div>
            <div class="hint">
              <b>Save Draft</b> – <span class="kbd">Ctrl</span> + <span class="kbd">S</span>
            </div>
            <div class="hint">
              <b>Export CSV</b> – <span class="kbd">Ctrl</span> + <span class="kbd">E</span>
            </div>
            <div class="hint">
              <b>Reset</b> – <span class="kbd">Ctrl</span> + <span class="kbd">Backspace</span>
            </div>
          </div>
        </section>
      </aside>
    </div>
  </main>

  <footer>
    <div class="container" style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <div>© <span id="year"></span> We Are Eleven</div>
      <div style="font-size:12px;color:#94a3b8">
        Built for internal auction operations.
      </div>
    </div>
  </footer>

  <template id="rowTemplate">
    <tr>
      <td class="monospace idx"></td>
      <td>
        <div style="display:flex;align-items:center;gap:10px">
          <img class="avatar" alt="" style="width:36px;height:36px;border-radius:10px;border:1px solid #e2e8f0;object-fit:cover" />
          <div>
            <div class="name" style="font-weight:700"></div>
            <div class="meta muted" style="font-size:12px"></div>
          </div>
        </div>
      </td>
      <td class="role monospace"></td>
      <td class="team"></td>
      <td>
        <select class="select poolSelect">
          <option>Gold</option>
          <option>Silver</option>
          <option>UnSold</option>
        </select>
      </td>
      <td>
        <div class="row-actions">
          <button class="btn btn-outline btnGold">Gold</button>
          <button class="btn btn-outline btnSilver">Silver</button>
          <button class="btn btn-outline btnUnsold">UnSold</button>
        </div>
      </td>
    </tr>
  </template>

  <script>
  (() => {
    const $ = (sel, root = document) => root.querySelector(sel);
    const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

    const dom = {
      // header
      btnSave: $('#btnSave'),
      btnLoad: $('#btnLoad'),
      btnExportCsv: $('#btnExportCsv'),
      btnReset: $('#btnReset'),

      // filters
      search: $('#search'),
      search2: $('#search2'),
      filterRole: $('#filterRole'),
      filterCategory: $('#filterCategory'),
      filterTeam: $('#filterTeam'),
      btnClearFilters: $('#btnClearFilters'),

      // table
      tbodyPlayers: $('#tbodyPlayers'),
      rowTemplate: $('#rowTemplate'),

      // pools count
      countGold: $('#countGold'),
      countSilver: $('#countSilver'),
      countUnSold: $('#countUnSold'),

      // results
      resultTeam: $('#resultTeam'),
      resultPlayer: $('#resultPlayer'),
      resultAmount: $('#resultAmount'),
      btnAddResult: $('#btnAddResult'),
      btnClearResult: $('#btnClearResult'),
      recentList: $('#recentList'),
      resultsBody: $('#resultsBody'),
      btnToggleResults: $('#btnToggleResults'),
    };

    // Data
    const TEAMS = ['Blazers', 'Dominators', 'Rockets', 'Spartans', 'Titans', 'Warriors'];

    const PLAYERS = [
      { name: 'Aditya', role: 'GK', team: 'Blazers',    img: 'Aditya.jpg' },
      { name: 'Amit', role: 'DEF', team: 'Blazers',      img: 'Amit.jpg' },
      { name: 'Anirudh', role: 'MID', team: 'Blazers',   img: 'Anirudh.jpg' },
      { name: 'Arun', role: 'FWD', team: 'Blazers',      img: 'Arun.jpg' },
      { name: 'Arvind', role: 'GK', team: 'Dominators',  img: 'Arvind.jpg' },
      { name: 'Ashish', role: 'DEF', team: 'Dominators', img: 'Ashish.jpg' },
      { name: 'Bharath', role: 'MID', team: 'Dominators',img: 'Bharath.jpg' },
      { name: 'Chirag', role: 'FWD', team: 'Dominators', img: 'Chirag.jpg' },
      { name: 'Deepak', role: 'GK', team: 'Rockets',     img: 'Deepak.jpg' },
      { name: 'Gokul', role: 'DEF', team: 'Rockets',     img: 'Gokul.jpg' },
      { name: 'Harish', role: 'MID', team: 'Rockets',    img: 'Harish.jpg' },
      { name: 'Jay', role: 'FWD', team: 'Rockets',       img: 'Jay.jpg' },
      { name: 'Kiran', role: 'GK', team: 'Spartans',     img: 'Kiran.jpg' },
      { name: 'Lakshman', role: 'DEF', team: 'Spartans', img: 'Lakshman.jpg' },
      { name: 'Mahesh', role: 'MID', team: 'Spartans',   img: 'Mahesh.jpg' },
      { name: 'Naveen', role: 'FWD', team: 'Spartans',   img: 'Naveen.jpg' },
      { name: 'Om', role: 'GK', team: 'Titans',          img: 'Om.jpg' },
      { name: 'Pranav', role: 'DEF', team: 'Titans',     img: 'Pranav.jpg' },
      { name: 'Rahul', role: 'MID', team: 'Titans',      img: 'Rahul.jpg' },
      { name: 'Sanjay', role: 'FWD', team: 'Titans',     img: 'Sanjay.jpg' },
      { name: 'Tarun', role: 'GK', team: 'Warriors',     img: 'Tarun.jpg' },
      { name: 'Uday', role: 'DEF', team: 'Warriors',     img: 'Uday.jpg' },
      { name: 'Vikram', role: 'MID', team: 'Warriors',   img: 'Vikram.jpg' },
      { name: 'Yash', role: 'FWD', team: 'Warriors',     img: 'Yash.jpg' },
    ];

    const state = {
      filters: { q: '', role: '', category: '', team: '' },
      tab: 'ALL',
      players: [],
      pools: {
        Gold: [],
        Silver: [],
        UnSold: [],
        UNSOLD: [], // running-unsold list (during auction)
      },
      results: [],
      recent: [],
    };

    // utils
    const slug = s => s.toLowerCase().replace(/\s+/g, '-');
    const matches = (p, q) => {
      if (!q) return true;
      const s = `${p.name} ${p.role} ${p.team}`.toLowerCase();
      return s.includes(q.toLowerCase());
    };

    const cloneData = () => {
      state.players = PLAYERS.map((p, i) => ({
        id: i + 1,
        ...p,
        pool: 'Gold', // default pool
      }));
      state.pools.Gold = state.players.map(p => p.id);
      state.pools.Silver = [];
      state.pools.UnSold = [];
      state.pools.UNSOLD = [];
      state.results = [];
      state.recent = [];
      updateCounts();
      render();
    };

    const updateCounts = () => {
      dom.countGold.textContent = String(state.pools.Gold.length);
      dom.countSilver.textContent = String(state.pools.Silver.length);
      dom.countUnSold.textContent = String(state.pools.UnSold.length);
    };

    const poolOf = (playerId) => {
      if (state.pools.Gold.includes(playerId)) return 'Gold';
      if (state.pools.Silver.includes(playerId)) return 'Silver';
      if (state.pools.UnSold.includes(playerId)) return 'UnSold';
      return null;
    };

    const moveToPool = (playerId, pool) => {
      ['Gold', 'Silver', 'UnSold'].forEach(k => {
        state.pools[k] = state.pools[k].filter(id => id !== playerId);
      });
      state.pools[pool].push(playerId);
      const p = state.players.find(x => x.id === playerId);
      if (p) p.pool = pool;
      updateCounts();
      render();
    };

    const render = () => {
      // filters
      const q = state.filters.q;
      const role = state.filters.role;
      const team = state.filters.team;
      const category = state.filters.category;

      const tab = state.tab;

      const rows = [];
      const tpl = dom.rowTemplate.content;

      const visible = state.players.filter(p => {
        if (q && !matches(p, q)) return false;
        if (role && p.role !== role) return false;
        if (team && p.team !== team) return false;
        if (category) {
          if (category === 'Gold' && poolOf(p.id) !== 'Gold') return false;
          if (category === 'Silver' && poolOf(p.id) !== 'Silver') return false;
          if (category === 'UnSold' && poolOf(p.id) !== 'UnSold') return false;
        }
        if (tab !== 'ALL') {
          if (tab === 'Gold' && poolOf(p.id) !== 'Gold') return false;
          if (tab === 'Silver' && poolOf(p.id) !== 'Silver') return false;
          if (tab === 'UnSold' && poolOf(p.id) !== 'UnSold') return false;
        }
        return true;
      });

      dom.tbodyPlayers.innerHTML = '';

      visible.forEach((p, idx) => {
        const node = document.importNode(tpl, true);
        $('.idx', node).textContent = String(p.id);
        $('.name', node).textContent = p.name;
        $('.meta', node).textContent = `${p.team} • ${p.role}`;
        $('.role', node).textContent = p.role;
        $('.team', node).textContent = p.team;
        $('.avatar', node).src = p.img || '';
        $('.avatar', node).alt = p.name;

        const sel = $('.poolSelect', node);
        sel.value = poolOf(p.id);
        sel.addEventListener('change', (e) => {
          moveToPool(p.id, e.target.value);
        });

        $('.btnGold', node).addEventListener('click', () => moveToPool(p.id, 'Gold'));
        $('.btnSilver', node).addEventListener('click', () => moveToPool(p.id, 'Silver'));
        $('.btnUnsold', node).addEventListener('click', () => moveToPool(p.id, 'UnSold'));

        dom.tbodyPlayers.appendChild(node);
      });
    };

    // results panel
    const renderRecent = () => {
      dom.recentList.innerHTML = '';
      state.recent.slice(0, 8).forEach(item => {
        const div = document.createElement('div');
        div.style.display = 'grid';
        div.style.gap = '6px';
        div.style.border = '1px solid #e2e8f0';
        div.style.borderRadius = '10px';
        div.style.padding = '8px 10px';
        div.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
            <div style="font-weight:700">${item.player}</div>
            <div class="monospace">₹ ${item.amount}</div>
          </div>
          <div class="muted" style="font-size:12px">${item.team}</div>
        `;
        dom.recentList.appendChild(div);
      });
    };

    const addResult = () => {
      const team = dom.resultTeam.value;
      const player = dom.resultPlayer.value.trim();
      const amount = Number(dom.resultAmount.value);
      if (!player || isNaN(amount)) return;
      state.results.unshift({ ts: Date.now(), team, player, amount });
      state.recent.unshift({ team, player, amount });
      dom.resultPlayer.value = '';
      dom.resultAmount.value = '';
      renderRecent();
    };

    // STORAGE
    const STORAGE_KEY = 'we-are-eleven-auctioneer-v1';

    const save = () => {
      const data = {
        state: {
          pools: state.pools,
          players: state.players,
          results: state.results,
          recent: state.recent,
        },
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      flash('Saved');
    };

    const load = () => {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return flash('No saved draft', 'warn');
      const data = JSON.parse(raw);
      if (data?.state) {
        state.pools = data.state.pools;
        state.players = data.state.players;
        state.results = data.state.results || [];
        state.recent = data.state.recent || [];
        updateCounts();
        render();
        renderRecent();
        flash('Loaded');
      }
    };

    const resetAll = () => {
      if (!confirm('Reset all auction data?')) return;
      localStorage.removeItem(STORAGE_KEY);
      cloneData();
      flash('Reset complete', 'warn');
    };

    // CSV
    const toCSV = () => {
      const rows = [
        ['Player', 'Team', 'Role', 'Pool'],
        ...state.players.map(p => [p.name, p.team, p.role, poolOf(p.id)]),
      ];
      const csv = rows.map(r => r.map(x => `"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'auction-players.csv';
      a.click();
      URL.revokeObjectURL(url);
    };

    // helpers
    const flash = (msg, type = 'ok') => {
      const bar = document.createElement('div');
      bar.textContent = msg;
      bar.style.position = 'fixed';
      bar.style.bottom = '20px';
      bar.style.left = '50%';
      bar.style.transform = 'translateX(-50%)';
      bar.style.background = type === 'ok' ? '#111827' : (type === 'warn' ? '#b45309' : '#7f1d1d');
      bar.style.color = 'white';
      bar.style.padding = '10px 14px';
      bar.style.borderRadius = '10px';
      bar.style.boxShadow = '0 10px 30px rgba(0,0,0,0.2)';
      bar.style.zIndex = '100';
      document.body.appendChild(bar);
      setTimeout(() => bar.remove(), 1400);
    };

    // EVENTS
    window.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
        e.preventDefault(); save();
      } else if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'e') {
        e.preventDefault(); toCSV();
      } else if ((e.ctrlKey || e.metaKey) && e.key === 'Backspace') {
        e.preventDefault(); resetAll();
      } else if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'k') {
        e.preventDefault(); dom.search2.focus();
      } else if (e.key === '?') {
        e.preventDefault();
        alert('Shortcuts:\n\nCtrl/⌘+S → Save Draft\nCtrl/⌘+E → Export CSV\nCtrl/⌘+Backspace → Reset\nCtrl/⌘+K → Focus Search');
      }
    });

    dom.btnSave.addEventListener('click', save);
    dom.btnLoad.addEventListener('click', load);
    dom.btnExportCsv.addEventListener('click', toCSV);
    dom.btnReset.addEventListener('click', resetAll);

    dom.btnClearFilters.addEventListener('click', () => {
      dom.search.value = '';
      dom.search2.value = '';
      dom.filterRole.value = '';
      dom.filterCategory.value = '';
      dom.filterTeam.value = '';
      state.filters = { q: '', role: '', category: '', team: '' };
      state.tab = 'ALL';
      $$('.tab').forEach(t => t.setAttribute('aria-selected', String(t.dataset.tab === 'ALL')));
      render();
    });

    const hookFilters = () => {
      const on = () => {
        state.filters.q = (dom.search.value || dom.search2.value || '').trim();
        state.filters.role = dom.filterRole.value || '';
        state.filters.category = dom.filterCategory.value || '';
        state.filters.team = dom.filterTeam.value || '';
        render();
      };
      [dom.search, dom.search2, dom.filterRole, dom.filterCategory, dom.filterTeam]
        .forEach(el => el.addEventListener('input', on));
    };

    $$('.tab').forEach(btn => {
      btn.addEventListener('click', () => {
        const key = btn.dataset.tab;
        state.tab = key;
        $$('.tab').forEach(t => t.setAttribute('aria-selected', String(t === btn)));
        render();
      });
    });

    dom.btnAddResult.addEventListener('click', addResult);
    dom.btnClearResult.addEventListener('click', () => {
      dom.resultPlayer.value = '';
      dom.resultAmount.value = '';
    });

    dom.btnToggleResults.addEventListener('click', () => {
      const el = dom.resultsBody;
      const hide = !el.classList.contains('hidden');
      el.classList.toggle('hidden', hide);
      dom.btnToggleResults.setAttribute('aria-pressed', String(!hide));
      renderResults();
    });

    const renderResults = () => {
      // currently just controls visibility, keep for future
    };

    document.getElementById('year').textContent = new Date().getFullYear();

    hookFilters();
    cloneData();

  })();
  </script>
</body>
</html>
